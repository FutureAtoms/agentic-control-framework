# Simple test for ACF npm installation
FROM node:22-slim

# Install basic tools
RUN apt-get update && apt-get install -y curl && apt-get clean

# Create test directory
WORKDIR /test

# Test npm installation
RUN echo "=== Installing ACF from npm ===" && \
    npm install -g agentic-control-framework@latest && \
    echo "Installation successful"

# Verify installation
RUN echo "=== Verifying installation ===" && \
    ls -la /usr/local/lib/node_modules/ | grep agentic || echo "Not found in node_modules" && \
    ls -la /usr/local/bin/ | grep acf || echo "acf not found" && \
    ls -la /usr/local/bin/ | grep agentic || echo "agentic binary not found"

# Test CLI
RUN echo "=== Testing CLI ===" && \
    acf --version && \
    echo "CLI works!"

# Test workspace initialization
WORKDIR /workspace
RUN echo "=== Testing workspace init ===" && \
    acf init --project-name "test" --project-description "test" && \
    ls -la .acf/

# Test MCP server with simple echo
RUN echo "=== Testing MCP server ===" && \
    timeout 2 echo '{"jsonrpc":"2.0","id":1,"method":"initialize","params":{"protocolVersion":"2024-11-05","capabilities":{}}}' | \
    npx -y agentic-control-framework /workspace || echo "Server started (timeout expected)"

CMD ["echo", "Tests completed successfully"]